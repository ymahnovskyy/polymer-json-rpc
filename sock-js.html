
<dom-module id="sockjs-component">
    <template>
      <paper-button on-click="send_message" raised>Send Message</paper-button>

      <p>Last result:</p>
      <p>{{rpcResult}}</p>

    </template>
    <script>
      SockJsSimpleBehavior = {
        'properties': {
          url : String,
        },
        ready: function () {
            this.sock = null;

            this.open_connection();
        },

        connection_established: function () {
            console.log('CONNECTION ESTABLISHED');
        },

        connection_closed: function () {
            console.log('CONNECTION CLOSED');
        },

        message_received: function (message) {
            console.log('RECEIVED: ' + message);
        },

        open_connection: function () {
            this.sock = new SockJS(this.url, {
                protocols_whitelist: ['websocket']
            });

            this.sock.onopen = this.connection_established;
            this.sock.onclose = this.connection_closed;
            this.register_receiver(this.message_received.bind(this));
        },

        register_receiver: function (receiver) {
            this.sock.onmessage = function(e) {
                receiver(e.data);
            };
        },

        send_message: function (message) {
            this.sock.send('test');
        }
      };
      Polymer({
        'is':'sockjs-component',
        behaviors: [SockJsSimpleBehavior]
      });
    </script>
</dom-module>
